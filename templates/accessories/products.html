{% extends 'base.html' %}
{% load static %}

{% block extra-styles %}
<link rel="stylesheet" href="{% static 'css/products.css' %}" />
{% endblock %}
{% block title %}Medical Products{% endblock %}
{% block content %}
<div class="products-page">
    <!-- Search Section -->
    <div class="search-section">
        <h2>üè• Medical Products & Accessories</h2>
        <form class="search-form" action="{% url 'accessories:product_search' %}" method="get">
            <input type="text" name="q" class="search-input" placeholder="Search for medical products..." value="{{ query }}">
            <button type="submit" class="search-btn">üîç Search</button>
        </form>
        {% if query %}
            <p style="margin-top: 15px; color: #666;">
                Search results for: "<strong>{{ query }}</strong>"
                <a href="{% url 'accessories:products' %}" style="color: #007bff; text-decoration: none;">(Show all products)</a>
            </p>
        {% endif %}
    </div>
    <!-- Products Grid -->
    {% if products %}
        <div class="products-grid">
            {% for product in products %}
                <div class="product-card">
                    <!-- Product Image -->
                    <div class="product-image">
                        {% if product.p_image %}
                            <img src="{{ product.p_image.url }}" alt="{{ product.p_name }}">
                        {% else %}
                            <img src="{% static 'image/no-image.png' %}" alt="No Image Available">
                        {% endif %}
                    </div>

                    <!-- Product Info -->
                    <div class="product-info">
                        <h3 class="product-name">{{ product.p_name }}</h3>

                        <div class="product-price">‡ß≥{{ product.p_cost }}</div>

                        <div class="product-stock">
                            {% if product.p_count > 10 %}
                                <span class="stock-status in-stock">‚úÖ In Stock ({{ product.p_count }})</span>
                            {% elif product.p_count > 0 %}
                                <span class="stock-status low-stock">‚ö†Ô∏è Low Stock ({{ product.p_count }})</span>
                            {% else %}
                                <span class="stock-status" style="background: #f8d7da; color: #721c24;">‚ùå Out of Stock</span>
                            {% endif %}
                        </div>

                        <p class="product-description">{{ product.p_description }}</p>

                        <div class="product-vendor">üè¢ Brand: {{ product.v_name }}</div>

                        <!-- Add to Cart -->
                        {% if user.is_authenticated and product.p_count > 0 %}
                            <form method="post" action="{% url 'accessories:add_to_cart' product.id %}" class="add-to-cart">
                                {% csrf_token %}
                                <label for="quantity" style="font-size: 14px; color: #666;">Qty:</label>
                                <input type="number" name="quantity" class="quantity-input"
                                       min="1" max="{{ product.p_count }}" value="1">
                                <button type="submit" class="add-btn">üõí Add to Cart</button>
                            </form>
                        {% elif not user.is_authenticated %}
                            <div class="add-to-cart">
                                <a href="{% url 'accounts:login' %}" class="add-btn" style="text-align: center; text-decoration: none;">
                                    üîê Login to Purchase
                                </a>
                            </div>
                        {% else %}
                            <div class="add-to-cart">
                                <button class="add-btn" disabled style="background: #ccc; cursor: not-allowed;">
                                    ‚ùå Out of Stock
                                </button>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Go to Cart Button -->
        {% if user.is_authenticated %}
            <div class="cart-section">
                <a href="{% url 'accessories:cart' %}" class="cart-btn">
                    üõí View Shopping Cart
                </a>
            </div>
        {% endif %}
    {% else %}
        <!-- No Products Found -->
        <div class="no-products">
            <h3>üîç No Products Found</h3>
            {% if query %}
                <p>No products match your search "{{ query }}"</p>
                <a href="{% url 'accessories:products' %}" class="cart-btn" style="margin-top: 15px;">
                    üìã View All Products
                </a>
            {% else %}
                <p>No medical products are currently available.</p>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}
